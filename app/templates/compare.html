{% extends "base.html" %}
{% block content %}
    <form method="post" action="{{ url_for('compare') }}" autocomplete="off">
        <label for="selected_user">Select user to compare:</label>
        <select name="selected_user" id="selected_user">
            {% for other_user in other_users %}
                <option value="{{ other_user.id }}" {% if selected_user and selected_user.id == other_user.id %}selected{% endif %}>
                    {{ other_user.username }}
                </option>
            {% endfor %}
        </select>

        <button type="submit" name="submit_user">Compare by User</button>
    </form>

    <form method="post" action="{{ url_for('compare') }}" autocomplete="off">
        <label for="selected_date">Select date to compare:</label>
        <select name="selected_date" id="selected_date">
            <option value="overall" {% if selected_date == 'overall' %}selected{% endif %}>Overall Comparison</option>
        </select>

        <button type="submit" name="submit_date">Compare by Date</button>
    </form>
    <p>
        {{ user.username }}<br>
        running stat 1<br>
        running stat 2<br>
        running stat 3<br>
        running stat 4<br>
        <br><br>
    </p>

    <h4>Runs of {{ user.username }}:</h4>
    <ul>
        {% for run in user_runs %}
            <li>{{ run.date }} - Distance: {{ run.distance }} km, Duration: {{ run.duration }} </li>
        {% endfor %}

    {% if selected_user %}
    <p>
        {{ selected_user.username }}<br>
        running stat 1<br>
        running stat 2<br>
        running stat 3<br>
        running stat 4<br>
        <br><br>
    </p>

    <h4>Runs of {{ selected_user.username }}:</h4>
    <ul>
        {% for run in selected_user_runs %}
            <li>{{ run.date }} - Distance: {{ run.distance }} km, Duration: {{ run.duration }} </li>
        {% endfor %}
    </ul>
{% endif %}

    {% if selected_date %}
        <h4>Comparison for: {{ selected_date }}</h4>
    {% endif %}

    <h3><a href="{{ url_for('day_display') }}">Home</a></h3>

    <script>
        // JavaScript code to dynamically update date options based on selected user
        document.getElementById('selected_user').addEventListener('change', function () {
            // Get the selected user ID
            var selectedUserId = this.value;

            // Fetch dates for the selected user using AJAX
            fetch(`/get_dates/${selectedUserId}`)
                .then(response => response.json())
                .then(data => {
                    // Clear existing options
                    var dateSelect = document.getElementById('selected_date');
                    dateSelect.innerHTML = '';

                    // Add new options
                    data.dates.forEach(function (date) {
                        var option = document.createElement('option');
                        option.value = date;
                        option.text = date;
                        dateSelect.add(option);
                    });
                });
        });
    </script>
{% endblock %}
